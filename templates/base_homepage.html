{% extends 'base.html' %}

{% block body %}
<div>
  <div class="jumbotron">
    <div class="container">
      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: center">
          <h2>Welcome to MeetForFree!</h2>
          <h4>Here you can meet people in free and public spaces. <br> Everyone has a right to public spaces.</h4>
        </div>
      </div>
    </div>
  </div>

    <div class="container">
      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: center">
          <h3>Places to explore:</h3>
            <div id="map"></div>
        </div>
      </div>
    </div>

    <br>
    <div class="container">
      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 top-buffer" style="text-align: center">
          <p>To search for a place, please login or register for an account.</p>
        </div>
      </div>
    </div>

    <script type="text/javascript">
        //create the google map
        function initMap() {
            var pos;
            var mapDiv = document.getElementById('map');
            var bounds = new google.maps.LatLngBounds();

            //temp array of locations - REPLACE WITH JSON DATA FROM Postgres
            var locations = [
                [37.795494, -122.402185],
                [37.7956, -122.5933],
            ];

            //find user's location via geolocation and drop a marker
            if (navigator.geolocation) {
                  navigator.geolocation.getCurrentPosition(function(position) {
                    pos = {
                      lat: position.coords.latitude,
                      lng: position.coords.longitude
                    };
                    infoWindow.setPosition(pos);
                    map.setCenter(pos);

                    //sets user's current location marker on the map
                    var userlocation = new google.maps.Marker({
                        position: pos,
                        map: map,
                        title: 'You are Here!'
                    });

                    infoWindow.setContent('You are Here!');//additional block, can replace with other color marker if we have time
                  }, function() {
                    handleLocationError(true, infoWindow, map.getCenter());
                  });
                } else {
                  // if browser doesn't support Geolocation, throw an error.
                  handleLocationError(false, infoWindow, map.getCenter());
                }
            //create map centered on users location
            var map = new google.maps.Map(mapDiv, {
                center: pos,
                zoom: 12,
                styles: [
                    {
                      featureType: 'all',
                      stylers: [
                        { saturation: -80 }
                      ]
                    },{
                      featureType: 'road.arterial',
                      elementType: 'geometry',
                      stylers: [
                        { hue: '#00ffee' },
                        { saturation: 50 }
                      ]
                    },{
                      featureType: 'poi.business',
                      elementType: 'labels',
                      stylers: [
                        { visibility: 'off' }
                      ]
                  },{
                        featureType: 'water',
                        elementType: 'labels',
                        stylers: [
                          { visibility: 'on' },
                          { hue: '#00eeff'},
                          { saturation: -50 }
                        ]
                      }
                  ]
            });

            var infoWindow = new google.maps.InfoWindow({map: map});
            //drop all location markers from array
            //for each location, extract the lat and long loop through the JSON data to create an annotation
            for (var i = 0; i < locations.length; i++) {
                createMarker(i);
            } //end for loop for place marker addition

            //call this separately to prevent last marker from always pulling up its content box on click
            function createMarker(i){
                var marker;
                var position = new google.maps.LatLng(locations[i][0], locations[i][1]);
                bounds.extend(position);

                var contentString = '<div id="content">'+ i
                   '<p>Content goes here</p>'+
                   '</div>';

                var infowindow = new google.maps.InfoWindow({
                    content: contentString
                });

                marker = new google.maps.Marker({
                    position: position,
                    map: map,
                    title: 'hi!!'
                });
                google.maps.event.addListener(marker, 'click', function() {
                    infowindow.open(map,marker);
                });
            }
            map.fitBounds(bounds);
        } //end init map
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDNab36EydKLH1ay3u8JjosC0zgNpPpRw4&callback=initMap"></script>

{% endblock %}
